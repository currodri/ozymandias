common_variables = dict(
    x = {'unit':'code_length','neighbour':False},
    y = {'unit':'code_length','neighbour':False},
    z = {'unit':'code_length','neighbour':False},
    d_euclid = {'unit':'code_length','neighbour':False},
    r_sphere = {'unit':'code_length','neighbour':False},
    theta_sphere = {'unit':'radian','neighbour':False},
    phi_sphere = {'unit':'radian','neighbour':False},
    r_cyl = {'unit':'code_length','neighbour':False},
    phi_cyl = {'unit':'radian','neighbour':False},
    mass = {'unit':'code_mass','neighbour':False},
    metal_mass = {'unit':'code_mass','neighbour':False},
    density = {'unit':'code_density','neighbour':False},
    velocity_x = {'unit':'code_velocity','neighbour':False},
    velocity_y = {'unit':'code_velocity','neighbour':False},
    velocity_z = {'unit':'code_velocity','neighbour':False},
    absv_sphere_r = {'unit':'code_velocity','neighbour':False},
    v_sphere_r = {'unit':'code_velocity','neighbour':False},
    v_sphere_phi = {'unit':'code_velocity','neighbour':False},
    v_sphere_theta = {'unit':'code_velocity','neighbour':False},
    vx = {'unit':'code_velocity','neighbour':False},
    vy = {'unit':'code_velocity','neighbour':False},
    vz = {'unit':'code_velocity','neighbour':False},
    vx_proj = {'unit':'code_velocity','neighbour':False},
    vy_proj = {'unit':'code_velocity','neighbour':False},
    vz_proj = {'unit':'code_velocity','neighbour':False},
    vx_box = {'unit':'code_velocity','neighbour':False},
    vy_box = {'unit':'code_velocity','neighbour':False},
    vz_box = {'unit':'code_velocity','neighbour':False},
    v_cyl_r = {'unit':'code_velocity','neighbour':False},
    v_cyl_z = {'unit':'code_velocity','neighbour':False},
    v_cyl_phi = {'unit':'code_velocity','neighbour':False},
    circular_velocity = {'unit':'code_velocity','neighbour':False},
    centripetal_acc = {'unit':'code_specific_energy/code_length','neighbour':False},
    v_magnitude = {'unit':'code_velocity','neighbour':False},
    v_tangential = {'unit':'code_velocity','neighbour':False},
    vrcyl_overv = {'unit':'dimensionless','neighbour':False},
    vzcyl_overv = {'unit':'dimensionless','neighbour':False},
    vphicyl_overv = {'unit':'dimensionless','neighbour':False},
    v_squared = {'unit':'code_velocity*code_velocity','neighbour':False},
    mach_number = {'unit':'dimensionless','neighbour':False},
    metallicity = {'unit':'code_metallicity','neighbour':False},
    kinetic_energy = {'unit':'code_energy','neighbour':False},
    momentum_x = {'unit':'code_mass*code_velocity','neighbour':False},
    momentum_y = {'unit':'code_mass*code_velocity','neighbour':False},
    momentum_z = {'unit':'code_mass*code_velocity','neighbour':False},
    momentum = {'unit':'code_mass*code_velocity','neighbour':False},
    momentum_sphere_r = {'unit':'code_mass*code_velocity','neighbour':False},
    absmomentum_sphere_r = {'unit':'code_mass*code_velocity','neighbour':False},
    momentum_cyl_z = {'unit':'code_mass*code_velocity','neighbour':False},
    ang_momentum_x = {'unit':'code_mass*code_length*code_velocity','neighbour':False},
    ang_momentum_y = {'unit':'code_mass*code_length*code_velocity','neighbour':False},
    ang_momentum_z = {'unit':'code_mass*code_length*code_velocity','neighbour':False},
    ang_momentum_specific_x = {'unit':'code_length*code_velocity','neighbour':False},
    ang_momentum_specific_y = {'unit':'code_length*code_velocity','neighbour':False},
    ang_momentum_specific_z = {'unit':'code_length*code_velocity','neighbour':False},
    ang_momentum = {'unit':'code_mass*code_length*code_velocity','neighbour':False},
    ang_momentum_specific = {'unit':'code_length*code_velocity','neighbour':False},
    counts = {'unit':'dimensionless','neighbour':False},
    cumulative = {'unit':'dimensionless','neighbour':False}
    
)
grid_variables = dict(
    temperature = {'unit':'code_temperature','neighbour':False},
    entropy_specific = {'unit':'code_specific_entropy','neighbour':False},
    pseudo_entropy = {'unit':'code_pseudo_entropy','neighbour':False},
    grad_entropy_cylz = {'unit':'code_pseudo_entropy/code_length','neighbour':True},
    grad_entropy_rsphere = {'unit':'code_pseudo_entropy/code_length','neighbour':True},
    volume = {'unit':'code_length*code_length*code_length','neighbour':False},
    sound_speed = {'unit':'code_velocity','neighbour':False},
    effective_sound_speed = {'unit':'code_velocity','neighbour':False},
    rms_speed = {'unit':'code_velocity','neighbour':False},
    alfven_speed = {'unit':'code_velocity','neighbour':False},
    massflow_rate = {'unit':'code_mass/code_time','neighbour':False},
    massflow_rate_sphere_r = {'unit':'code_mass/code_time','neighbour':False},
    massflux_rate_sphere_r = {'unit':'code_mass/code_time/code_length/code_length','neighbour':False},
    div_v = {'unit':'dimensionless/code_time','neighbour':True},
    B_left_x = {'unit':'code_magnetic','neighbour':False},
    B_left_y = {'unit':'code_magnetic','neighbour':False},
    B_left_z = {'unit':'code_magnetic','neighbour':False},
    B_right_x = {'unit':'code_magnetic','neighbour':False},
    B_right_y = {'unit':'code_magnetic','neighbour':False},
    B_right_z = {'unit':'code_magnetic','neighbour':False},
    Bz_cyl = {'unit':'code_magnetic','neighbour':False},
    Bphi_cyl = {'unit':'code_magnetic','neighbour':False},
    Br_cyl = {'unit':'code_magnetic','neighbour':False},
    Br_sphere = {'unit':'code_magnetic','neighbour':False},
    Btheta_sphere = {'unit':'code_magnetic','neighbour':False},
    Bphi_sphere = {'unit':'code_magnetic','neighbour':False},
    thermal_pressure = {'unit':'code_pressure','neighbour':False},
    thermal_energy = {'unit':'code_energy','neighbour':False},
    thermal_energy_specific = {'unit':'code_specific_energy','neighbour':False},
    thermal_energy_density = {'unit':'code_energy_density','neighbour':False},
    net_cooling = {'unit':'code_energy_density/code_time','neighbour':False},
    cooling_rate = {'unit':'code_energy_density/code_time','neighbour':False},
    heating_rate = {'unit':'code_energy_density/code_time','neighbour':False},
    grad_therprsphere = {'unit':'code_pressure/code_length','neighbour':True},
    grad_therpz = {'unit':'code_pressure/code_length','neighbour':True},
    torque_therp_specific = {'unit':'code_specific_energy','neighbour':True},
    total_coolingtime = {'unit':'code_time','neighbour':True},
    freefall_time = {'unit':'code_time','neighbour':False},
    compression_time = {'unit':'code_time','neighbour':True},
    compcooltime_ratio = {'unit':'dimensionless','neighbour':True},
    inflow_time = {'unit':'code_time','neighbour':True},
    Bx_proj = {'unit':'code_magnetic','neighbour':False},
    By_proj = {'unit':'code_magnetic','neighbour':False},
    Bz_proj = {'unit':'code_magnetic','neighbour':False},
    Bzcyl_overB = {'unit':'dimensionless','neighbour':False},
    Bphicyl_overB = {'unit':'dimensionless','neighbour':False},
    Brcyl_overB = {'unit':'dimensionless','neighbour':False},
    magnetic_magnitude = {'unit':'code_magnetic','neighbour':False},
    magnetic_energy = {'unit':'code_energy','neighbour':False},
    magnetic_energy_specific = {'unit':'code_specific_energy','neighbour':False},
    magnetic_energy_density = {'unit':'code_energy_density','neighbour':False},
    magnetic_pressure = {'unit':'code_pressure','neighbour':False},
    torque_magp_specific = {'unit':'code_specific_energy','neighbour':True},
    grad_magprsphere = {'unit':'code_pressure/code_length','neighbour':True},
    plasma_beta = {'unit':'dimensionless','neighbour':False},
    cr_energy = {'unit':'code_energy','neighbour':False},
    cr_energy_density = {'unit':'code_energy_density','neighbour':False},
    cr_pressure = {'unit':'code_pressure','neighbour':False},
    norm_crflux_advection = {'unit':'code_energy_density*code_velocity','neighbour':False},
    norm_crflux_streaming = {'unit':'code_energy_density*code_velocity','neighbour':False},
    norm_crflux_diffusion = {'unit':'code_energy_density*code_velocity','neighbour':True},
    streamflux_diffflux_ratio = {'unit':'dimensionless','neighbour':True},
    chi_cr = {'unit':'dimensionless','neighbour':False},
    gamma_ray_luminosity = {'unit':'code_energy/code_time','neighbour':False},
    grad_crp = {'unit':'code_pressure/code_length','neighbour':True},
    grad_crp_dotmag = {'unit':'radian','neighbour':True},
    grad_density_dotmag = {'unit':'radian','neighbour':True},
    absgrad_density_dotmag = {'unit':'dimensionless','neighbour':True},
    grad_crprsphere = {'unit':'code_pressure/code_length','neighbour':True},
    grad_crpz = {'unit':'code_pressure/code_length','neighbour':True},
    grad_thermalpressure = {'unit':'code_pressure/code_length','neighbour':True},
    torque_crp_specific = {'unit':'code_specific_energy','neighbour':True},
    gradscale_crprsphere = {'unit':'code_length','neighbour':True},
    gradscale_crp = {'unit':'code_length','neighbour':True},
    cr_energy_specific = {'unit':'code_specific_energy','neighbour':False},
    diffusion_speed = {'unit':'code_velocity','neighbour':True},
    alfvendiff_ratio = {'unit':'dimensionless','neighbour':True},
    stheatcooling_ratio = {'unit':'dimensionless','neighbour':True},
    cr_temperature_eff = {'unit':'code_temperature','neighbour':False},
    cr_GH08heat = {'unit':'code_energy_density/code_time','neighbour':False},
    streaming_heating = {'unit':'code_energy_density/code_time','neighbour':True},
    grav_centfrsphere = {'unit':'dimensionless','neighbour':False},
    grav_crpf = {'unit':'dimensionless','neighbour':True},
    grav_crpfz = {'unit':'dimensionless','neighbour':True},
    grav_therpfz = {'unit':'dimensionless','neighbour':True},
    grav_crpfrsphere = {'unit':'dimensionless','neighbour':True},
    grav_crpfrspherepos = {'unit':'dimensionless','neighbour':True},
    grav_crpfrsphereneg = {'unit':'dimensionless','neighbour':True},
    grav_therpfrsphere = {'unit':'dimensionless','neighbour':True},
    grav_therpfrspherepos = {'unit':'dimensionless','neighbour':True},
    grav_therpfrsphereneg = {'unit':'dimensionless','neighbour':True},
    torque_totp_specific = {'unit':'code_specific_energy','neighbour':True},
    grav_totpfrsphere = {'unit':'dimensionless','neighbour':True},
    grav_totpfrspherepos = {'unit':'dimensionless','neighbour':True},
    grav_totpfrsphereneg = {'unit':'dimensionless','neighbour':True},
    grav_magpfrsphere = {'unit':'dimensionless','neighbour':True},
    grav_magpfrspherepos = {'unit':'dimensionless','neighbour':True},
    grav_magpfrsphereneg = {'unit':'dimensionless','neighbour':True},
    fP_thermal = {'unit':'dimensionless','neighbour':True},
    fP_turbulent = {'unit':'dimensionless','neighbour':True},
    fP_magnetic = {'unit':'dimensionless','neighbour':True},
    fP_cr = {'unit':'dimensionless','neighbour':True},
    fe_thermal = {'unit':'dimensionless','neighbour':False},
    torque_grav_specific = {'unit':'code_specific_energy','neighbour':False},
    grav_frsphere = {'unit':'code_pressure/code_length','neighbour':False},
    grav_gz = {'unit':'code_specific_energy/code_length','neighbour':False},
    grav_grsphere = {'unit':'code_specific_energy/code_length','neighbour':False},
    grav_fz = {'unit':'code_pressure/code_length','neighbour':False},
    xHI = {'unit':'dimensionless','neighbour':False},
    xHII = {'unit':'dimensionless','neighbour':False},
    xHeII = {'unit':'dimensionless','neighbour':False},
    xHeIII = {'unit':'dimensionless','neighbour':False},
    dust_density = {'unit':'code_density','neighbour':False},
    DTM = {'unit':'dimensionless','neighbour':False},
    eff_FKmag = {'unit':'dimensionless','neighbour':True},
    eff_FKmagnocr = {'unit':'dimensionless','neighbour':True},
    eff_FK2 = {'unit':'dimensionless','neighbour':True},
    jeans_mtt = {'unit':'code_length','neighbour':True},
    jeansmtt_dx = {'unit':'dimensionless','neighbour':True},
    neighbour_accuracy = {'unit':'dimensionless','neighbour':True},
    sigma = {'unit':'code_velocity','neighbour':True},
    turbulent_pressure = {'unit':'code_pressure','neighbour':False}
)
particle_variables = dict(
    age = {'unit':'Gyr','neighbour':False},
    tform = {'unit':'code_time','neighbour':False},
    sfr = {'unit':'code_mass/code_time','neighbour':False},
    sfr_density = {'unit':'code_mass/Gyr/code_length**3','neighbour':False},
    sfr_surface = {'unit':'code_density*code_velocity','neighbour':False},
    sdensity = {'unit':'code_density*code_length','neighbour':False}
)

basic_conv = dict(
    code_length = 'kpc',
    code_mass = 'Msun',
    code_density = 'g*cm**-3',
    code_velocity = 'km*s**-1',
    code_energy = 'erg',
    code_specific_energy = 'erg*g**-1',
    code_specific_energy_code_length = 'cm*s**-2',
    code_energy_density = 'erg*cm**-3',
    code_energy_density_code_time = 'erg*s**-1*cm**-3',
    code_pressure = 'erg*cm**-3',
    code_pressure_code_length = 'erg*cm**-4',
    code_specific_entropy = 'erg*K**-1*g**-1',
    code_density_code_velocity_code_velocity = 'erg*cm**-3',
    code_density_code_velocity = 'Msun*yr**-1*kpc**-2',
    code_density_code_length = 'Msun*kpc**-2',
    code_mass_code_time = 'Msun*yr**-1',
    dimensionless = 'dimensionless',
    radian ='radian',
    code_magnetic = 'gauss',
    code_temperature = 'K',
    code_metallicity = 'dimensionless',
    code_time = 'yr',
    Gyr = 'Gyr'
)

def get_code_units(varname):

    if varname in common_variables:
        unit = common_variables[varname]['unit']
    elif varname in grid_variables:
        unit = grid_variables[varname]['unit']
    elif varname in particle_variables:
        unit = particle_variables[varname]['unit']
    else:
        raise KeyError('Variable not found, check: '+str(varname))
    return unit
    
def check_need_neighbours(varname):
    if varname in common_variables:
        need = common_variables[varname]['neighbour']
    elif varname in grid_variables:
        need = grid_variables[varname]['neighbour']
    elif varname in particle_variables:
        need = particle_variables[varname]['neighbour']
    else:
        raise KeyError('Variable not found, check: '+str(varname))
    return need